-- AdvancedUILibrary with UICorners (by ChatGPT)
-- Safe for Roblox Studio (for your own game UI systems)

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")

local UI = {}
UI.__index = UI

-- quick helper
local function addCorner(parent, radius)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, radius or 6)
	corner.Parent = parent
end

local function safeCall(fn, ...)
	if fn then
		local ok, err = pcall(fn, ...)
		if not ok then warn("UI callback error:", err) end
	end
end

function UI:MakeDraggable(frame, handle)
	local dragging, offset
	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			offset = input.Position - frame.AbsolutePosition
		end
	end)
	handle.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
	UIS.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			frame.Position = UDim2.new(0, input.Position.X - offset.X, 0, input.Position.Y - offset.Y)
		end
	end)
end

-- main window
function UI:CreateWindow(props)
	props = props or {}
	local player = Players.LocalPlayer
	local screen = Instance.new("ScreenGui")
	screen.Name = props.Name or "AdvancedUI"
	screen.ResetOnSpawn = false
	screen.IgnoreGuiInset = true
	screen.Parent = player:WaitForChild("PlayerGui")

	local frame = Instance.new("Frame")
	frame.Size = props.Size or UDim2.new(0, 440, 0, 320)
	frame.Position = props.Position or UDim2.new(0.5, -220, 0.5, -160)
	frame.BackgroundColor3 = props.BackgroundColor3 or Color3.fromRGB(38, 38, 38)
	frame.BorderSizePixel = 0
	frame.Parent = screen
	addCorner(frame, props.CornerRadius or 8)

	-- Title bar
	local title = Instance.new("Frame", frame)
	title.Size = UDim2.new(1, 0, 0, 32)
	title.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
	addCorner(title, props.CornerRadius or 8)

	local titleText = Instance.new("TextLabel", title)
	titleText.Size = UDim2.new(1, -60, 1, 0)
	titleText.Position = UDim2.new(0, 10, 0, 0)
	titleText.BackgroundTransparency = 1
	titleText.Text = props.Title or "UI Window"
	titleText.Font = Enum.Font.GothamBold
	titleText.TextSize = 16
	titleText.TextXAlignment = Enum.TextXAlignment.Left
	titleText.TextColor3 = Color3.fromRGB(240,240,240)

	local closeBtn = Instance.new("TextButton", title)
	closeBtn.Size = UDim2.new(0, 28, 0, 28)
	closeBtn.Position = UDim2.new(1, -34, 0, 2)
	closeBtn.Text = "âœ•"
	closeBtn.Font = Enum.Font.SourceSansBold
	closeBtn.TextSize = 20
	closeBtn.BackgroundColor3 = Color3.fromRGB(80,30,30)
	closeBtn.TextColor3 = Color3.new(1,1,1)
	addCorner(closeBtn, props.CornerRadius or 6)

	local tabBar = Instance.new("Frame", frame)
	tabBar.Position = UDim2.new(0, 0, 0, 32)
	tabBar.Size = UDim2.new(1, 0, 0, 32)
	tabBar.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
	addCorner(tabBar, props.CornerRadius or 8)

	local container = Instance.new("Frame", frame)
	container.Position = UDim2.new(0, 0, 0, 64)
	container.Size = UDim2.new(1, 0, 1, -64)
	container.BackgroundTransparency = 1

	local tabs, tabContents = {}, {}
	local function addTab(name)
		local i = #tabs + 1
		local tabBtn = Instance.new("TextButton")
		tabBtn.Size = UDim2.new(0, (frame.Size.X.Offset/#(props.Tabs or {1})), 0, 32)
		tabBtn.Position = UDim2.new(0, (i-1)*((frame.Size.X.Offset)/#(props.Tabs or {1})), 0, 0)
		tabBtn.Text = name
		tabBtn.Font = Enum.Font.SourceSansBold
		tabBtn.TextSize = 15
		tabBtn.TextColor3 = Color3.new(1,1,1)
		tabBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
		tabBtn.Parent = tabBar
		addCorner(tabBtn, props.CornerRadius or 8)

		local content = Instance.new("Frame", container)
		content.Size = UDim2.new(1, 0, 1, 0)
		content.BackgroundTransparency = 1
		content.Visible = (i == 1)
		local layout = Instance.new("UIListLayout", content)
		layout.Padding = UDim.new(0, 8)
		layout.SortOrder = Enum.SortOrder.LayoutOrder
		local pad = Instance.new("UIPadding", content)
		pad.PaddingLeft = UDim.new(0, 10)
		pad.PaddingTop = UDim.new(0, 10)
		tabContents[name] = content

		tabBtn.MouseButton1Click:Connect(function()
			for _, v in pairs(tabContents) do v.Visible = false end
			content.Visible = true
		end)

		table.insert(tabs, tabBtn)
		return content
	end

	local win = {}
	win.Frame = frame
	win.Container = container
	win.AddTab = addTab

	function win:AddButton(parent, props)
		local b = Instance.new("TextButton")
		b.Size = UDim2.new(0, 160, 0, 36)
		b.BackgroundColor3 = Color3.fromRGB(80,80,80)
		b.Text = props.Text or "Button"
		b.TextColor3 = Color3.new(1,1,1)
		b.Font = Enum.Font.SourceSansBold
		b.TextSize = 16
		addCorner(b, props.CornerRadius or 6)
		b.Parent = parent
		if props.Callback then b.MouseButton1Click:Connect(function() safeCall(props.Callback) end) end
	end

	function win:AddToggle(parent, props)
		local f = Instance.new("Frame", parent)
		f.Size = UDim2.new(0, 180, 0, 36)
		f.BackgroundTransparency = 1

		local btn = Instance.new("TextButton", f)
		btn.Size = UDim2.new(0, 36, 0, 36)
		btn.BackgroundColor3 = Color3.fromRGB(120,120,120)
		btn.Text = ""
		addCorner(btn, props.CornerRadius or 6)

		local lbl = Instance.new("TextLabel", f)
		lbl.Size = UDim2.new(0, 100, 1, 0)
		lbl.Position = UDim2.new(0, 46, 0, 0)
		lbl.BackgroundTransparency = 1
		lbl.Text = props.Text or "Toggle"
		lbl.TextColor3 = Color3.new(1,1,1)
		lbl.Font = Enum.Font.SourceSans
		lbl.TextSize = 16

		local state = props.Default or false
		btn.BackgroundColor3 = state and Color3.fromRGB(0,180,0) or Color3.fromRGB(120,120,120)
		btn.MouseButton1Click:Connect(function()
			state = not state
			btn.BackgroundColor3 = state and Color3.fromRGB(0,180,0) or Color3.fromRGB(120,120,120)
			safeCall(props.Callback, state)
		end)
	end

	closeBtn.MouseButton1Click:Connect(function()
		frame:Destroy()
	end)

	self:MakeDraggable(frame, title)
	container.Parent = frame
	return win
end

return UI
