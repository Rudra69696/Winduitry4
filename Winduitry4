--[[
    Advanced Roblox UI Library
    Features: Window, Tabs, Button, Slider, Toggle
    Place this script in ReplicatedStorage and require it from your LocalScript.
]]

local UIS = game:GetService("UserInputService")

local UI = {}

-- Helper to make draggable window
function UI:MakeDraggable(frame)
    local dragging, offset
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            offset = input.Position - frame.AbsolutePosition
        end
    end)
    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            frame.Position = UDim2.new(0, input.Position.X - offset.X, 0, input.Position.Y - offset.Y)
        end
    end)
end

-- Create main window
function UI:CreateWindow(props)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = game.Players.LocalPlayer.PlayerGui

    local frame = Instance.new("Frame")
    frame.Size = props.Size or UDim2.new(0, 400, 0, 300)
    frame.Position = props.Position or UDim2.new(0.5, -200, 0.5, -150)
    frame.BackgroundColor3 = props.BackgroundColor3 or Color3.fromRGB(40, 40, 40)
    frame.BorderSizePixel = 0
    frame.Parent = screenGui

    self:MakeDraggable(frame)
    return frame
end

-- Create tab system
function UI:CreateTabs(window, tabNames)
    local tabs = {}
    local tabBar = Instance.new("Frame")
    tabBar.Size = UDim2.new(1, 0, 0, 32)
    tabBar.Position = UDim2.new(0,0,0,0)
    tabBar.BackgroundColor3 = Color3.fromRGB(50,50,50)
    tabBar.Parent = window

    local tabWidth = math.floor(400 / #tabNames)
    local tabContents = {}

    for i, name in ipairs(tabNames) do
        local tabBtn = Instance.new("TextButton")
        tabBtn.Size = UDim2.new(0, tabWidth, 0, 32)
        tabBtn.Position = UDim2.new(0, (i-1)*tabWidth, 0, 0)
        tabBtn.Text = name
        tabBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
        tabBtn.TextColor3 = Color3.fromRGB(255,255,255)
        tabBtn.Font = Enum.Font.SourceSans
        tabBtn.TextSize = 18
        tabBtn.Parent = tabBar

        local tabContent = Instance.new("Frame")
        tabContent.Size = UDim2.new(1, 0, 1, -32)
        tabContent.Position = UDim2.new(0,0,0,32)
        tabContent.BackgroundTransparency = 1
        tabContent.Visible = (i == 1) -- Show first tab by default
        tabContent.Parent = window
        tabContents[name] = tabContent

        tabBtn.MouseButton1Click:Connect(function()
            for _, content in pairs(tabContents) do
                content.Visible = false
            end
            tabContent.Visible = true
        end)

        tabs[name] = {Button = tabBtn, Content = tabContent}
    end

    return tabs
end

-- Button
function UI:CreateButton(parent, props)
    local button = Instance.new("TextButton")
    button.Size = props.Size or UDim2.new(0, 120, 0, 36)
    button.Position = props.Position or UDim2.new(0, 10, 0, 10)
    button.BackgroundColor3 = props.BackgroundColor3 or Color3.fromRGB(90, 90, 90)
    button.Text = props.Text or "Button"
    button.TextColor3 = props.TextColor3 or Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.SourceSans
    button.TextSize = props.TextSize or 18
    button.Parent = parent
    if props.Callback then
        button.MouseButton1Click:Connect(props.Callback)
    end
    return button
end

-- Toggle
function UI:CreateToggle(parent, props)
    local frame = Instance.new("Frame")
    frame.Size = props.Size or UDim2.new(0, 120, 0, 36)
    frame.Position = props.Position or UDim2.new(0,10,0,56)
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0,36,0,36)
    btn.Position = UDim2.new(0,0,0,0)
    btn.BackgroundColor3 = Color3.fromRGB(100,100,100)
    btn.Text = ""
    btn.Parent = frame

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(0,70,0,36)
    lbl.Position = UDim2.new(0,46,0,0)
    lbl.BackgroundTransparency = 1
    lbl.Text = props.Text or "Toggle"
    lbl.TextColor3 = Color3.fromRGB(255,255,255)
    lbl.Font = Enum.Font.SourceSans
    lbl.TextSize = 16
    lbl.Parent = frame

    local state = props.Default or false
    btn.BackgroundColor3 = state and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(100,100,100)
    
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.BackgroundColor3 = state and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(100,100,100)
        if props.Callback then props.Callback(state) end
    end)
    return frame
end

-- Slider
function UI:CreateSlider(parent, props)
    local frame = Instance.new("Frame")
    frame.Size = props.Size or UDim2.new(0, 200, 0, 36)
    frame.Position = props.Position or UDim2.new(0, 10, 0, 100)
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(0, 160, 0, 8)
    bar.Position = UDim2.new(0,20,0,14)
    bar.BackgroundColor3 = Color3.fromRGB(180,180,180)
    bar.BorderSizePixel = 0
    bar.Parent = frame

    local knob = Instance.new("Frame")
    knob.Size = UDim2.new(0,16,0,24)
    knob.Position = UDim2.new(0,20,0,-4)
    knob.BackgroundColor3 = Color3.fromRGB(50,150,255)
    knob.BorderSizePixel = 0
    knob.Parent = frame

    local min = props.Min or 0
    local max = props.Max or 100
    local value = props.Default or min

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(0,50,0,24)
    lbl.Position = UDim2.new(0, 0, 0, -28)
    lbl.BackgroundTransparency = 1
    lbl.Text = tostring(value)
    lbl.TextColor3 = Color3.fromRGB(255,255,255)
    lbl.Font = Enum.Font.SourceSans
    lbl.TextSize = 16
    lbl.Parent = frame

    local function setValue(newValue)
        value = math.clamp(newValue, min, max)
        lbl.Text = tostring(math.floor(value))
        local percent = (value-min)/(max-min)
        knob.Position = UDim2.new(0, 20 + percent*160 - 8, 0, -4)
        if props.Callback then props.Callback(value) end
    end

    setValue(value)

    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local moveConn
            moveConn = UIS.InputChanged:Connect(function(moveInput)
                if moveInput.UserInputType == Enum.UserInputType.MouseMovement then
                    local mouseX = moveInput.Position.X
                    local barAbsPos = bar.AbsolutePosition.X
                    local percent = math.clamp((mouseX - barAbsPos) / 160, 0, 1)
                    setValue(min + percent * (max - min))
                end
            end)
            knob.InputEnded:Connect(function(endInput)
                if endInput.UserInputType == Enum.UserInputType.MouseButton1 then
                    if moveConn then moveConn:Disconnect() end
                end
            end)
        end
    end)
    return frame
end

return UI
